#!/bin/sh

# Random wallpaper setter
# Selects random wallpaper from local wallpaper directory

# === CONFIGURATION ===
WALLPAPER_DIR="${HOME}/.local/share/wallpapers"

# === VALIDATION ===
if [ ! -d "${WALLPAPER_DIR}" ]; then
    exit 0
fi

# === FILE DISCOVERY ===
IMAGES=$(find "${WALLPAPER_DIR}" -type f \
    \( -iname "*.jpg" -o -iname "*.jpeg" -o -iname "*.png" -o -iname "*.webp" \) \
    2>/dev/null)

if [ -z "${IMAGES}" ]; then
    exit 0
fi

# === RANDOM SELECTION ===
COUNT=$(printf '%s\n' "${IMAGES}" | wc -l)
RANDOM_NUM=$(awk -v max="${COUNT}" 'BEGIN{srand(); print int(rand()*max)+1}')
WALLPAPER=$(printf '%s\n' "${IMAGES}" | sed -n "${RANDOM_NUM}p")

# === SET WALLPAPER ===
if [ -n "${WALLPAPER}" ]; then
    feh --bg-fill "${WALLPAPER}"
fi
